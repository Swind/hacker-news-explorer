---
name: incremental-update
description: 增量更新流程。使用時機：分析已存在報告的文章時、需要更新舊分析時。
---

# 增量更新工作流程

## 使用時機
- 當你發現要分析的文章已經有報告時
- 需要更新舊的分析時
- 評論數量顯著增加時

## 工作流程

### 第一步：檢查是否已有報告

在開始任何分析之前，必須先檢查：

```python
search_report_by_id(story_id=XXXXX)
```

### 第二步：根據結果決定下一步

**情況 A：報告不存在**
→ 進行完整分析，使用 `create_report()` 創建新報告

**情況 B：報告已存在**
→ 繼續第三步

### 第三步：讀取舊報告

```python
read_report(story_id=XXXXX, metadata_only=true)
```

查看舊報告的：
- 創建時間
- 評價（verdict）
- 當時的評論數量

### 第四步：判斷是否需要更新

比較評論數量變化：

| 評論增長 | 行動 |
|---------|------|
| < 10%   | 跳過更新，回覆「無顯著新討論」 |
| 10-30%  | 可選更新，視內容決定 |
| > 30%   | **必須更新** |

### 第五步：更新報告

使用 `append_report()` 添加新內容：

```markdown
## 更新 [YYYY-MM-DD]

**新評論數：** +X 條評論（總共 Y 條）

### 新討論重點
[總結新的評論和討論]

### 更新評價（如有變化）
[如果評價改變，說明原因]
```

## 重要原則

1. **永遠先檢查**：不要假設報告不存在
2. **避免重複**：不要為同一個故事創建多個報告
3. **增量而非替換**：使用 `append_report` 而非重新創建
4. **標註時間**：更新內容必須標註日期
5. **說明變化**：清楚說明為什麼需要更新

## 錯誤處理

如果 `create_report()` 返回「報告已存在」的錯誤：
→ 使用 `append_report()` 來添加內容
→ 或使用 `read_report()` 來查看現有內容

## 範例

**場景：分析一篇 3 天前的文章**

1. `search_report_by_id(12345)` → 發現報告存在
2. `read_report(12345, metadata_only=true)` → 舊報告顯示 50 條評論
3. 檢查 HN → 現在有 80 條評論（+60%）
4. 讀取新評論，分析新討論
5. `append_report(12345, "## 更新 [2026-02-02]\n\n**新評論數：** +30 條...")`
